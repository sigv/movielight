/* eslint-env browser, jquery */
$(function(){"use strict";var e={},i={};$.fn.api.settings.api={search:"/m/search/{query}"},$(".ui.modal").modal({blurring:!0,onHide:function(t){i={},history.pushState({},"","/#m"+(e.id||"")+"/p"+(i.id||"")),document.title=(e.title?e.title+" • ":"")+"Movie Light"}});var t=function(t){e={id:t},t&&$.ajax("/m/"+t,{dataType:"json",success:function(t){if(t&&t.movie&&t.movie.id===e.id){history.pushState({},"","/#m"+(e.id||"")+"/p"+(i.id||"")),e=t.movie,document.title=(i.name?i.name:t.movie.title)+" • Movie Light",$(".actors").empty();for(var o=function(e){n($(e.currentTarget).data("id"))},s=0;s<t.movie.cast.length;s++){var r=t.movie.cast[s],a=$('<div class="clickable two wide column"><img class="ui fluid circular image"><br><p><b class="name"></b><br><em class="role"></em></p></div>');a.data("id",r.id),a.find(".image").attr("src",r.imageUrl),a.find(".name").text(r.name),a.find(".role").text(r.role),a.click(o),$(".actors").append(a)}}}})},n=function(t){i={id:t},t&&$.ajax("/p/"+t,{dataType:"json",success:function(t){if(t&&t.person&&t.person.id===i.id){history.pushState({},"","/#m"+(e.id||"")+"/p"+(i.id||"")),i=t.person,document.title=t.person.name+" • Movie Light";var n=$(".ui.modal");n.find(".header .name").text(t.person.name),n.find(".header .subname").text([t.person.age?"1"===t.person.age?"1 year old":t.person.age+" years old":"",t.person.alsoKnownAs&&t.person.alsoKnownAs.length>0?"also known as "+t.person.alsoKnownAs.join(", "):""].filter(function(e){return"string"==typeof e&&""!==e}).join(" • ")),n.find(".profile").attr("src",t.person.imageUrl),n.find(".bio").text(t.person.bio||""),n.find(".movies").empty();for(var o=0;o<t.person.movies.length;o++){var s=t.person.movies[o],r=$('<div class="four wide movie column"><img class="ui fluid rounded image"><br><p><b class="title"></b><br><em class="year"></em></p></div>');r.find(".image").attr("src",s.posterUrl),r.find(".title").text(s.title),r.find(".year").text(s.year),n.find(".movies").prepend(r)}setTimeout(function(){n.modal("show")},1)}}})};$(".ui.search").search({apiSettings:{onResponse:function(e){for(var i=0;i<e.movies.length;i++)for(var t in e.movies[i])e.movies[i].hasOwnProperty(t)&&!e.movies[i][t]&&delete e.movies[i][t];return e}},transition:"swing down",duration:300,cache:!1,fields:{results:"movies",description:"year",image:"posterUrl"},onSelect:function(e,i){return $(".poster").attr("src",e.posterUrl||""),$(".title").text(e.originalTitle+(e.year?" ("+e.year+")":"")),$(".subtitle").text(e.title!==e.originalTitle?e.title:""),$(".synopsis").text(e.description||""),t(e.id),!0},onResultsOpen:function(){$(".bodycontainer").dimmer("show")},onResultsClose:function(){$(".bodycontainer").dimmer("hide")}})});